#!/usr/bin/env ruby

require 'optparse'
require_relative 'terraform_runner'
require_relative 'ansible_runner'

options = {}
OptionParser.new do |opts|
  opts.banner = 'Usage: ansible.rb [options]'

  opts.on('-c', '--command COMMAND', 'Specify command') do |cmd|
    options[:command] = cmd
  end

  opts.on('-e', '--env ENV', 'Specify env') do |env|
    options[:env] = env
  end

  opts.on('-m', '--module MODULE', 'Specify module') do |mod|
    options[:module] = mod
  end

  opts.on('-t', '--tags TAGS', 'Specify tags') do |tags|
    options[:tags] = tags
  end

  opts.on('-i', '--inventory INVENTORY', 'Specify inventory') do |inventory|
    options[:inventory] = inventory
  end

  opts.on('-a', '--args ARGS', 'Specify args') do |args|
    options[:args] = args
  end
end.parse!

case options[:command]
when 'apply', 'destroy'
  TerraformRunner.new(options).run
when 'run'
  runner = "#{options[:module].capitalize}Runner"
  Object.const_get(runner).new(options).run
end
